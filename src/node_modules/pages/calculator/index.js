import React, {useEffect, useState} from 'react'
import useFetch from "hooks/useFetch";

const Calculator = () => {
    const [product, setProduct] = useState('Продукт')
    const [gramsInput, setGramsInput] = useState(-1)
    const [apiUrl, setApiUrl] = useState('')
    const [{isLoading, error, response}, doFetch] = useFetch(apiUrl)
    console.log("isLoading - ", isLoading, "response - ", response, "doFetch - ", doFetch)
    const [nameProd, setNameProd] = useState("Продукт")
    const [proteinA, setProteinA] = useState(0)
    const [proteinV, setProteinV] = useState(0)
    const [fatsA, setFatsA] = useState(0)
    const [fatsV, setFatsV] = useState(0)
    const [carbohydratesF, setCarbohydratesF] = useState(0)
    const [carbohydratesS, setCarbohydratesS] = useState(0)
    const [calories, setCalories] = useState(0)
    const [grams, setGrams] = useState(0)


    const handleSubmit = event => {
        event.preventDefault()

        const data = {product}

        setApiUrl('/search')
        setGrams(100) // переделать
        doFetch({
            method: 'post',
            data
        })
    }
    useEffect(() => {
        const data = gramsInput > -1? {product, gramsInput} : {product}
        gramsInput >-1 ? setApiUrl('/calculator'): setApiUrl('/search')
        setGrams(gramsInput) // переделать
        doFetch({
            method: 'post',
            data
        })
    }, [gramsInput])

    useEffect(() => {
        if (!response) {
            return
        }

        setProduct(response.name)
        setNameProd(response.name)
        setProteinA(response.protein_a)
        setProteinV(response.protein_v)
        setFatsA(response.fats_a)
        setFatsV(response.fats_v)
        setCarbohydratesF(response.carbohydrates_f)
        setCarbohydratesS(response.carbohydrates_s)
        setCalories(response.calories)
    }, [response])

    return (
        <div className="container text-center">
            <h5 className="poduct-h">{nameProd}</h5>
            <div className="row">
                <div className="col-4">
                    <div className="card text-bg-light mb-3">
                        <div className="card-header">
                           <p className="p-in-card">
                               На
                               <input
                                   type="text"
                                   className="form-input-width"
                                   placeholder="100"
                                   onChange={e => setGramsInput(e.target.value)}
                               />
                               г. продукта
                           </p>
                        </div>
                        <div className="card-body">
                            <table className="table">
                                <tbody>
                                <tr>
                                    <td className="td-name">grams</td>
                                    <td></td>
                                    <td>{grams} g.</td>
                                </tr>
                                <tr>
                                    <td className="td-name">Animal protein</td>
                                    <td></td>
                                    <td>{proteinA} g.</td>
                                </tr>
                                <tr>
                                    <td className="td-name">Vegetable protein</td>
                                    <td></td>
                                    <td>{proteinV} g.</td>
                                </tr>
                                <tr>
                                    <td className="td-name">Animal fats</td>
                                    <td></td>
                                    <td>{fatsA} g.</td>
                                </tr>
                                <tr>
                                    <td className="td-name">Vegetable fats</td>
                                    <td></td>
                                    <td>{fatsV} g.</td>
                                </tr>
                                <tr>
                                    <td className="td-name">Fast carbohydrates</td>
                                    <td></td>
                                    <td>{carbohydratesF} g.</td>
                                </tr>
                                <tr>
                                    <td className="td-name">Slow carbohydrates</td>
                                    <td></td>
                                    <td>{carbohydratesS} g.</td>
                                </tr>
                                <tr>
                                    <td className="td-name">Сalories</td>
                                    <td></td>
                                    <td>{calories} g.</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div className="col-4">
                    <div className="card text-bg-light mb-3 card-height">
                        <div className="card-header">
                            <p>Соотношение БЖУ</p>
                        </div>
                        <div className="card-body">
                            <h5 className="card-title">Light card title</h5>

                        </div>
                    </div>
                </div>
                <div className="col-4">
                    <div className="card text-bg-light mb-3 card-height">
                        <div className="card-header">Поиск</div>
                        <div className="card-body card-body-flex">
                            <form onSubmit={handleSubmit}>
                                <fieldset>
                                    <fieldset className="form-group">
                                        <input
                                            type="text"
                                            className=""
                                            placeholder="Название продукта"
                                            onChange={e => setProduct(e.target.value)}
                                        />
                                    </fieldset>
                                    <button
                                        disabled={isLoading}
                                        className=""
                                        type="submit"
                                    >
                                        Search
                                    </button>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    )
}

export default Calculator
